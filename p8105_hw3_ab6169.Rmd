---
title: "p8105_hw3_ab6169"
author: "Amrutha Banda"
date: "2025-10-03"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(janitor)
library(ggplot2)
library(patchwork)

```

## Problem 1 
```{r}
library(p8105.datasets)
data("instacart")
```

Short Description: 

```{r}
aisles_summary= 
  instacart |> 
  count(aisle, sort=TRUE)

aisles_summary |> 
  head(10) #This gives me a table that shows me top 10 aisles with the most ordered items 
```
Comments: 



Making a Plot n>10,000
```{r}
aisles_summary |> 
  filter(n > 10000) |> 
  mutate(aisle = fct_reorder(aisle, n)) |> #shows me aisles based on n (size)
  ggplot(aes(x = aisle, y = n, fill = aisle)) +
  geom_col(show.legend = FALSE) +
  coord_flip() ##flips the long aisle names
  labs(
    title = "Number of Items Ordered by Aisle (>10,000 orders)",
    x = "Aisle",
    y = "Number of Items Ordered"
  )
```
Comments: 



Table of 3 most popular items 
```{r}
instacart |> 
  filter(aisle %in% 
    c("baking ingredients", "dog food care", "packaged vegetables fruits")) |> 
  group_by(aisle, product_name) |>
  summarize(n = n()) |> 
  slice_max(order_by = n, n = 3) |> 
  knitr::kable(digits = 0)
```
Comments: 



Table of Mean Hour of the Day
```{r}
instacart |> 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) |> 
  group_by(product_name, order_dow) |> 
  summarize(mean_hour = mean(order_hour_of_day)) |> 
  mutate(order_dow = recode(order_dow,
  `0` = "Sun",
  `1` = "Mon", 
  `2` = "Tue",
  `3` = "Wed",
  `4` = "Thu", 
  `5` = "Fri",
  `6` = "Sat")) |> 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour ) |> 
  knitr::kable(digits=2) 
               
```
Comments: 


## Problem 2 

```{r}
zipcodes_df= 
  read_csv("data/zipcodes.csv", na = c("NA", ".", "")) |>
  janitor::clean_names() |> 
  select(-state_fips, -file_date) |> 
  mutate(
    borough=recode(county,
          "Kings"= "Brooklyn",
          "New York"= "Manhattan",
          "Richmond"= "Staten Island") 
  ) |> 
  select(borough, county, zip_code, neighborhood)


zori_df = 
  read_csv("data/zori.csv", na = c("NA", ".", "")) |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = starts_with("x20"),
    names_to = "date",
    values_to = "zori"
  ) |> 
  rename(
    zip_code= region_name) |> 
  mutate(county_name= str_remove(county_name, " County")) |> 
  rename(county= county_name) |> 
  select(-city, -metro, -region_type, -state_name, -state, ) |> 
  mutate(date = sub("^x", "", date))

#Joined DataFrame
mergezip_df=
  left_join(zipcodes_df, zori_df, by = c("zip_code","county"))
```


```{r}
##Made a column for just year 
mergezip_df = 
  mergezip_df |> 
  mutate(year = as.numeric(substr(date, 1, 4)))
```


```{r}
borough_year_df = 
  mergezip_df |> 
  group_by(borough, year) |> 
  summarize(
    mean_zori = mean(zori, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  arrange(borough, year)


```


Reader Friendly Table 
```{r}
borough_year_df |> 
  knitr::kable(
    digits = 0,
    col.names = c("Borough", "Year", "Average ZORI (USD)")
  )
```

After making the table, I did notice some trends. Manhattan continues to have the higher average rental prices from 2015-2024. This is followed by Brooklyn and Queens. I notice that Bronx has the most affordable rental prices among the boroughs.

Plot: NYC Rental Prices within ZIP codes for all available years.
```{r}
plot_comparison =
  mergezip_df |> 
  ggplot(aes(x = year, y = zori, color = borough)) +
  geom_point(alpha = 0.25, size = 0.8) +
  geom_smooth(se = FALSE, linewidth = 1.4) +
  labs(
    title = "NYC Rental Prices by Borough (2015–2024)",
    subtitle = "Each point represents a ZIP code; smooth lines show borough-level trends",
    x = "Year",
    y = "Average ZORI (Rent Index)",
    color = "Borough"
  ) +
  viridis::scale_color_viridis(discrete = TRUE) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "bottom",
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 11, margin = margin(b = 10))
  )


```
Comments 

Plot: distribution of ZIP-code-level rental prices across boroughs
```{r}

 zip2023_df =
  mergezip_df |> 
  filter(year == 2023) |>                
  group_by(borough, zip_code) |>         
  summarize(
    mean_zori = mean(zori, na.rm = TRUE),
    .groups = "drop"
  )
```

```{r}
plot_zip2023 =
  zip2023_df |> 
  ggplot(aes(x = borough, y = mean_zori, fill = borough)) +
  geom_violin(alpha = 0.7, trim = FALSE) +
  geom_boxplot(width = 0.12, color = "white", outlier.shape = NA) +
  labs(
    title = "Distribution of Average ZIP-Code Rental Prices by Borough (2023)",
    subtitle = "Each violin shows ZIP-level rent distribution; white boxes mark median and quartiles.",
    x = "Borough",
    y = "Average ZORI (Rent Index)",
    caption = "Data: Zillow Observed Rent Index (ZORI), Jan–Dec 2023"
  ) +
  viridis::scale_fill_viridis(discrete = TRUE) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 11, margin = margin(b = 10))
  )



```


Combining the two previous plots 
```{r}
combined_plot= 
  (plot_comparison / plot_zip2023) + plot_annotation(
    title = "NYC Rental Price Trends and 2023 Borough Distributions",
    caption = "Top: 2015–2024 trends; Bottom: 2023 ZIP-level rent distributions"
  )

ggsave("results/nyc_rental_summary.png", combined_plot,
       width = 10, height = 10, units = "in")
```


## Problem 3 

Cleaning and Tidying Data
```{r}

nhanes_accel= 
  read.csv("data/nhanes_accel.csv", na = c("NA", ".", "")) |> 
  janitor::clean_names()

##Pivoted Longer
nhanes_accel_long = 
  nhanes_accel |> 
  pivot_longer(
    cols = starts_with("min"), 
    names_to = "minute", 
    values_to = "mims") |> 
  mutate(
    minute = as.numeric(str_remove(minute, "min")))

  
  
```

```{r}
nhanes_covar= 
  read.csv("data/nhanes_covar.csv", skip=4, na = c("NA", ".", "")) |> 
  janitor::clean_names() |> 
  drop_na() |> 
  filter(age>= 21) |> 
  mutate(
    sex = recode(sex, "1" = "Male", "2" = "Female"),
    education = recode(education,
      "1" = "Less than High School",
      "2" = "High School Equivalent",
      "3" = "More than High School"),
      sex = factor(sex), 
    education = factor(education, 
                       levels = c("Less than High School", 
                                  "High School Equivalent", 
                                  "More than High School")))

      


  
 
```


Merged Dataset
```{r}
nhanes_merged = 
  left_join(nhanes_covar, nhanes_accel_long, by = "seqn")
```

